package kz.qazmarka.h2k.schema;

import org.apache.hadoop.hbase.TableName;

/**
 * Простейший декодер значений HBase.
 *
 * Назначение:
 * - Возвращает сырые байты значения как есть (zero-copy) ради максимальной скорости.
 * - Не зависит от Phoenix и не опирается на схему таблицы — подходит для универсального/сырого режима.
 *
 * Контракт zero-copy:
 * - Метод {@link #decode(org.apache.hadoop.hbase.TableName, String, byte[])} возвращает исходный массив {@code byte[]} без копирования.
 * - Вызывающая сторона НЕ должна модифицировать массив и должна при необходимости скопировать его, если предполагается длительное хранение.
 *
 * Свойства:
 * - Потокобезопасен (не содержит состояния и изменяемых полей).
 * - Дешёвый вызов: одна проверка на null и один возврат ссылки.
 * - Для исключения лишних аллокаций рекомендуется использовать общий экземпляр {@link #INSTANCE}.
 */
public final class SimpleDecoder implements Decoder {

    /** Опциональный общий экземпляр для переиспользования без аллокаций. */
    public static final SimpleDecoder INSTANCE = new SimpleDecoder();

    /**
     * Пустой конструктор: декодер не имеет состояния.
     * Предпочтительнее использовать общий экземпляр {@link #INSTANCE}, чтобы избежать создания объектов.
     * Публичная видимость оставлена для совместимости с внешним кодом и DI-фреймворками.
     */
    public SimpleDecoder() {
        /* Ничего инициализировать не требуется: класс не содержит состояния.
           Конструктор оставлен публичным для совместимости с возможным внешним кодом,
           хотя предпочтительно использовать общий экземпляр INSTANCE без аллокаций. */
    }

    /**
     * Декодирует значение без знания точного типа.
     * Параметры {@code table} и {@code qualifier} не используются (декодер не зависит от схемы).
     *
     * @param table     имя таблицы (не используется)
     * @param qualifier имя колонки (не используется)
     * @param value     сырые байты значения; если null — возвращается null
     * @return тот же массив байтов или null
     */
    @Override
    public Object decode(TableName unusedTable, String unusedQualifier, byte[] value) {
        if (value == null) return null; // быстрый путь
        // Возвращаем сырые байты без копирования ради максимальной скорости.
        // Внимание: вызывающая сторона не должна модифицировать массив,
        // либо должна скопировать его при длительном хранении.
        return value;
    }
}