# file: .env.example

# --- PostgreSQL (журнал) ---
PG_DSN=postgresql://etl_user:password@10.254.3.91:5432/etl_database?connect_timeout=5&keepalives=1&keepalives_idle=30&keepalives_interval=10&keepalives_count=5
JOURNAL_TABLE=public.inc_processing
PROCESS_NAME=codes_history_increment
JOURNAL_RETENTION_DAYS=1

# --- Phoenix ---
PQS_URL=http://10.254.3.112:8765
HBASE_MAIN_TABLE=TBL_JTI_TRACE_CIS_HISTORY
HBASE_MAIN_TS_COLUMN=opd
HBASE_MAIN_COLUMNS=c,t,opd,id,did,rid,rinn,rn,sid,sinn,sn,gt,prid,st,ste,elr,emd,apd,exd,p,pt,o,pn,b,tt,tm,ch,j,pg,et,pvad,ag
PHX_FETCHMANY_SIZE=5000
# 'seconds' | 'millis' | 'timestamp' — для phoenixdb
PHX_TS_UNITS=timestamp

# --- Грануляция и PQS окна ---
# размер бизнес-слайда в минутах
STEP_MIN=10
# сдвиг окна запроса (минуты) относительно бизнес-интервала
PHX_QUERY_SHIFT_MINUTES=-300
# захлёст влево, как правило только на первом слайсе
PHX_QUERY_OVERLAP_MINUTES=5
PHX_OVERLAP_ONLY_FIRST_SLICE=1
# лаг вправо, чтобы не брать «кипящие» записи
PHX_QUERY_LAG_MINUTES=2

# --- ClickHouse (только native:9000) ---
CH_HOSTS=10.254.3.111,10.254.3.112,10.254.3.113,10.254.3.114
CH_PORT=9000
CH_DB=stg
CH_USER=default
CH_PASSWORD=
# Таблицы:
# RAW (Distributed) — источник для дедупа
CH_RAW_TABLE=stg.daily_codes_history_raw_all
# «Чистая» таблица (реплицируемая)
CH_CLEAN_TABLE=stg.daily_codes_history
# Distributed над «чистой»
CH_CLEAN_ALL_TABLE=stg.daily_codes_history_all
# Буфер для дедупа (реплицируемая, БЕЗ TTL)
CH_DEDUP_BUF_TABLE=stg.daily_codes_history_dedup_buf
# --- ClickHouse insert ---
CH_INSERT_BATCH=20000
CH_INSERT_MAX_RETRIES=1

# --- Каденс публикаций ---
# публиковать не чаще, чем раз в 60 минут (0 — выключить правило по времени)
PUBLISH_EVERY_MINUTES=60
# публиковать каждые 6 успешных слайсов (при STEP_MIN=10 это ≈1 час; 0 — выключить)
PUBLISH_EVERY_SLICES=6
# в конце запуска всегда опубликовать оставшиеся партиции (0 — не делать)
ALWAYS_PUBLISH_AT_END=1